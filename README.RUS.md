<div id="badges">
  <a href="https://www.linkedin.com/in/vasilev-vitalii/">
    <img src="https://img.shields.io/badge/LinkedIn-blue?style=for-the-badge&logo=linkedin&logoColor=white" alt="LinkedIn Badge"/>
  </a>
  <a href="https://www.youtube.com/@user-gj9vk5ln5c/featured">
    <img src="https://img.shields.io/badge/YouTube-red?style=for-the-badge&logo=youtube&logoColor=white" alt="Youtube Badge"/>
  </a>
</div>

[English](README.md)

# vv-ddl-gen

**vv-ddl-gen** — это утилита для генерации DDL-скриптов и скриптов заполнения данных для баз данных Oracle (в будущем планируется добавить режимы работы для PostgreSQL и MSSQL). Утилита позволяет гибко настраивать, какие объекты и данные выгружать, а также поддерживает как полное, так и частичное заполнение таблиц.

## Основные возможности

* Генерация DDL-скриптов для различных объектов базы данных (таблицы, представления, индексы, процедуры, пакеты и др.)
* Генерация скриптов полного или частичного заполнения таблиц данными (INSERT)
* Гибкая настройка через конфигурационный файл (JSONC)
* Шифрование пароля для хранения в настройках

## Режимы работы

#### Генерация шаблона конфигурационного файла
```bash
vv-ddl-gen --conf-gen /путь/к/каталогу
```
Создаёт пример файла настроек (JSONC), который можно отредактировать под свои задачи.
#### Шифрование пароля для подключения к БД (необязательно)
```bash
vv-ddl-gen --crypt ваш_пароль
```
Возвращает зашифрованный пароль, который можно безопасно использовать в конфиге. **Внимание!** Это больше защита от дурака, чем от опытного хакера.
#### Основной режим - генерация DDL и скриптов данных по конфигу
```bash
vv-ddl-gen --conf-use /путь/к/вашему/конфигу.jsonc
```
Читает файл настроек и генерирует скрипты согласно описанным в нём правилам.

## Быстрый старт

1. #### Запустите генерацию файла настроек
```bash
vv-ddl-gen --conf-gen ./
```

2. #### Откройте созданный файл vv-ddl-get.config.TEMPLATE.ORA.jsonc, в нем
    * Замените все вхождения подстроки 'path/to/' на подстроку './'
    * В разделе "db"."connection" в параметрах "host","post","service","login","password" укажите актуальные реквизиты подключения к вашей БД Oracle
    * В разделе "objects"."schema"."list" укажите существующие на вашем сервере схемы
    * Сохраните файл конфигурации

3. #### Запустите генерацию DDL
```bash
vv-ddl-gen --conf-use ./vv-ddl-get.config.TEMPLATE.ORA.jsonc
```
4. #### Посмотррите результат
    * В подкаталоге "log" - результат логирования работы утилиты
    * В подкаталоге "ddl" - скрипты

## Важные особенности и нюансы

1. #### Отключение генерации через параметр dir = null
В каждом разделе настроек (например, table, view, index и т.д.) есть параметр dir, определяющий путь для сохранения соответствующих скриптов. Если указать dir равным null, то генерация этой части данных будет полностью отключена. Это удобно, если вы хотите исключить, например, индексы или триггеры из выгрузки.

2. #### Особое поведение для раздела package_body
В разделе package_body параметр dir работает особым образом:
* Если dir указан — тело пакета (body) сохраняется в отдельный файл.
* Если dir равен null — тело пакета добавляется в тот же файл, что и заголовок, при условии, что для заголовка пакета (package.dir)включена генерация.

3. #### Приоритет полного и демо-заполнения таблиц
Если таблица указана в списке table_fill_full.list, то для неё не будет сгенерирован демо-скрипт из раздела table_fill_demo.
Это позволяет избежать дублирования и случайного смешивания полного и примерного дампа данных.

4. #### Не предназначена для массовой выгрузки больших таблиц
Утилита не предназначена для массовой выгрузки данных из больших таблиц.
Массовая выгрузка предполагается только для таблиц-конфигураций или небольших справочников.
Для выгрузки больших объёмов данных используйте специализированные инструменты.

5. #### **Простое** шифрование пароля средствами утилиты
Вы можете зашифровать пароль для подключения к базе данных с помощью самой утилиты. Это позволяет не хранить пароль в открытом виде в конфигурационном файле. **Внимание!** Это больше защита от дурака, чем от опытного хакера.